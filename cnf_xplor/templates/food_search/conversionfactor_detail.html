{% extends 'base.html' %}

{% block extra_css %}
<style>

.card-wide {
    width: 36rem;
}

.container-fluid {
    text-align: center;
}

#conversionfactor_dt_wrapper {
    text-align: left;
}

.icons {
    float: right;
    cursor: pointer;
    padding-right: 5px;
}

.rightmost-icon {
    padding-right: 25px;
}

        .dataTables_wrapper { font-size: 12px }

    table.dataTable tbody th, table.dataTable tbody td {
    padding: 4px 4px; /* e.g. change 8x to 4px here */
}


</style>
{% endblock extra_css %}

{% block content %}

      <div class="row">
    <div class="col-sm-10">

        <div class="card">
        <div class="card-header">
            Food code:
        </div>
        <div class="card-body card-body-big" id="food_c">
              {{ food.FOOD_C }}
        </div>
        </div>

        <div class="card">
        <div class="card-header">
            Group code:
        </div>
        <div class="card-body card-body-big">
              {{ food.GROUP.GROUP_C }}
        </div>
        </div>

        <div class="card">
        <div class="card-header">
            Source code:
        </div>
        <div class="card-body card-body-big">
              {{ food.SOURCE.SOURCE_C }}
        </div>
        </div>

        <div class="card card-wide w-auto"> <!-- w-auto somehow makes it so that it won't let the text hang over. -->
        <div class="card-header">
            Food description:
        </div>
        <div class="card-body card-body-big">
              {{ food.FOOD_DESC }}
        </div>
        </div>
    </div>

      <div class="col-sm-2">
    <i class="far fa-edit fa-2x icons rightmost-icon" id="edit_food" data-toggle="tooltip" title="Edit"></i>
  <i class="fas fa-history fa-2x icons" id="edit_food_history" data-toggle="tooltip" title="History of edits"></i>
<i class="fas fa-capsules fa-2x icons" id="nutrients" data-toggle="tooltip" title="Nutrients"></i>
          <i class="fas fa-apple-alt fa-2x icons" id="food_detail" data-toggle="tooltip" title="Food detail"></i>
      </div>
      </div>


    <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <table id="conversionfactor_dt" class="table table-striped table-bordered" style="width:100%">
          <thead>
            <tr>
              <th data-data="CF_FACTOR_C">should not be seen</th>
              <th data-data="MEASURE_DESC">Measure description</th>
                <th data-data="MEASURE_DESC_F">Measure description (Fr)</th>
              <th data-data="MEASURE_ABBRV">Measure abbreviation</th>
              <th data-data="CONV_FACTOR">Conversion Factor</th>
              <th data-data="DATE_ENTRY">Date of Entry</th>
              <th data-data="FLAG_CFG">Flag CFG</th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
</div>

{%  endblock content %}

{% block extra_javascript %}

<script>
      $(document).ready(function() {
          let s = "/viewfood/conversionfactor_dt/?food_c={{ food.FOOD_C }}&format=datatables";
          console.log(s);
          $('#conversionfactor_dt').DataTable({
              //"serverSide": true,
                      "processing": true,
              "searching": true,
              "processing": true,
              "destroy": true,
              // "dom": 'Zlfrtip',
              //  "scrollX": true, // These two put a space in between the header and the lower part
              //  "scrollY": false,
              "dom": 'BZfrtip', // Adds button and resize
              "ajax": s,
              "colReorder": true,
              "altEditor": true,
              "select": true,
              "pageLength": 100,
              "bFilter": false,
              "bPaginate": false,
              "bLengthChange": false,
              "columns": [
                  {"data": "CF_FACTOR_C", "visible": false},
                  {"data": "MEASURE_ID.MEASURE_DESC"},
                  {"data": "MEASURE_ID.MEASURE_DESC_F"},
                  {"data": "MEASURE_ID.MEASURE_ABBRV"},
                  {"data": "CONV_FACTOR"},
                  {"data": "DATE_ENTRY"},
                  {"data": "FLAG_CFG"}
              ],
                      buttons: [
            {
            text: 'Edit',
            name: 'edit'
        },
            {
                text: 'History',
                name: 'history',
              }],

              onEditRow: function (datatable, rowdata, success, error) {

            s = '/viewfood/conversionfactor_update/' + rowdata['CF_FACTOR_C'] + "/";
            $.ajaxSetup({
                headers: {"X-CSRFToken": csrftoken}
            });

            // Remove things that should not be changed
                  delete rowdata["DATE_ENTRY"];

            $.ajax({
                url: s,
                type: 'PUT',
                data: rowdata,
                success: success,
                error:error,
                //error: function (jqXHR, textStatus, errorThrown) {
                //    console.log(jqXHR.responseText);
                //},
            });

            // Make it so the modal can scroll again
            $("#nutrient_modal").css('overflow-y', 'auto');
        }


          });
      });

        // Fix these
        document.getElementById("edit_food").addEventListener("click", function () {
            let food_c = $("#food_c").text().replace(/\s/g, "");
            window.location.href = "/food_enter/update/" + food_c;
        }, false);

        document.getElementById("edit_food_history").addEventListener("click", function () {
            let food_c = $("#food_c").text().replace(/\s/g, "");
            window.location.href = "/history/food_history/" + food_c;
        }, false);

        document.getElementById("food_detail").addEventListener("click", function () {
            let food_c = $("#food_c").text().replace(/\s/g, "");
            window.location.href = "/foodandgroup_dt/fooddetail/" + food_c;
        }, false);

        document.getElementById("nutrients").addEventListener("click", function () {
            let food_c = $("#food_c").text().replace(/\s/g, "");
            window.location.href = "/foodandgroup_dt/nutrient_dt/" + food_c;
        }, false);


</script>

{% endblock extra_javascript %}
